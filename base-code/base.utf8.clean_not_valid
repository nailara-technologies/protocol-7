## >:] ##

# name  = base.utf8.clean_not_valid

my $s_ref = shift;
my $l_lvl = shift // 2;    ## log level for errors ##
my $c_lvl = shift // 0;    ## caller level for reporting ##
$s_ref = \$s_ref if ref($s_ref) ne 'SCALAR';

return 0 if not utf8::is_utf8($$s_ref);    ## nothing to do here ##

if ( not defined <base.utf8.test_fh> ) {
    open( <base.utf8.test_fh>, '>', File::Spec->devnull() )
        or warn "<devnull> : \l$OS_ERROR";
    binmode( <base.utf8.test_fh>, ':encoding(UTF-8)' );
}

eval {
    use warnings FATAL => 'utf8';
    say {<base.utf8.test_fh>} $$s_ref;
};

if ($EVAL_ERROR) {
    ( my $err_str = lc($EVAL_ERROR) ) =~ s|(, may not.+)? at .+$||g;
    <[base.log]>->(
        $l_lvl,
        join( ' ', ':: not valid UTF-8 ::', <[base.caller]>->($c_lvl) )
    );
    <[base.log]>->( ++$l_lvl, ':.' . $err_str );

    return <[base.clean_unicode]>->($s_ref);   ## <-- num. characters replaced

} else {
    return 0;                                  ## no changes ##
}

#,,,.,..,,,.,,,,,,,,.,,,.,..,,.,,,,..,,,.,,.,,..,,...,...,.,,,,,,,.,.,,..,,,,,
#ATBAFPKM5FUWNIPNQRVG2C2F4CCR3EUYRS63WQOEFZ2XXV7LZO5FHSIPP2ZAKAUFQH2GEXO3HNQQY
#\\\|XLFOEZFVWSOMFFHQZBFKMHEOQQDDCERVFILI73Q2JZE6Z3CACEW \ / AMOS7 \ YOURUM ::
#\[7]XEISFBUQZQYD5STWFHCSHAO2I4LGMMN2KF7SH6NG757MPCBOFMCY 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
