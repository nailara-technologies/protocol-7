# >:]

# name = base.check_dependency_dirs

my $user     = shift // <system.amos-zenka-user>;
my $zenka    = <system.zenka.name>;
my $cfg_path = <system.conf_path>;

my ( undef, undef, $uid, $gid ) = getpwnam($user)
    or return <[base.logs]>->(
    2, "<< check_dependency_dirs :user '%s' not in passwd file >>", $user
    );

my @sub_dirs = qw|
    os-dep
    os-dep/binary
    os-dep/debian
    pm-dep
    source
    |;

my $dep_dir = <[base.get_path.zenka_cfg]>;

if (    $dep_dir =~ s|zenki/$zenka/config$|$cfg_path/zenki/$zenka|
    and -d $dep_dir
    and -w $dep_dir
    and opendir( my $dir_fh, $dep_dir ) ) {
    my @dir_names = grep { !m|^\,| } readdir($dir_fh);
    close($dir_fh);

    my $src_stat = File::stat::stat($dep_dir);

    foreach my $sub_dir (@sub_dirs) {
        my $dir_path = "$dep_dir/$sub_dir";
        ## create ##
        if ( !-d $dir_path ) {
            mkdir($dir_path)
                or <[base.s_warn]>->(
                'mkdir[%s] : %s',
                $dir_path, <[base.format_error]>->($OS_ERROR)
                );
        }
        next if !-d $dir_path;

        my $dir_stat = File::stat::stat($dir_path);

        ## chmod ##
        chmod( 0775, $dir_path ) if $dir_stat->mode != 0755;
        if ( $dir_stat->uid != $src_stat->uid or $dir_stat->gid != $gid ) {
            ## chown ##
            chown( $src_stat->uid, $gid, $dir_path )
                or <[base.s_warn]>->(
                'chown[ %s ] : %s',
                $dir_path, <[base.format_error]>->($OS_ERROR)
                );
        }
        ## placeholder ##
        my $placeholder_path = "$dir_path/.placeholder";
        if ( !-e $placeholder_path ) {
            open( my $fh, qw| > |, $placeholder_path ) or next;
            close($fh);
        }
        chown($placeholder_path);
    }
}

#.............................................................................
#XUE43MX2ISBEXSHW4QTTLNUNOZBD4X37I45KOVNZQDTL5IJS6DKNEXE4DP6WG72HUDKBFDB4P44M4
#::: D5RFY5UQL5SG55EIFJQLSR5LNX3POKK2NKG4YX6HV34CQ5PRKKV :::: NAILARA AMOS :::
# :: JKCKKKJVIHQT3H3FUT6ZB4UA75EAFJPYHAVBTMGOPHFJM5ZV4UBI :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
