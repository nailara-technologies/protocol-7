# >:]

# name  = pdf.html.base.valid_pdf
# param = <pdf_path> [width]

my $file_path = shift;

return 0
    if not defined $file_path
    or !length($file_path)
    or !-f $file_path
    or -z $file_path;

my $file_fh;

<[base.log]>->( 2, "[PDF] '$file_path'.." );

if ( !open( $file_fh, $file_path ) ) { warn $OS_ERROR; return 0; }

my $file_ok = 2;

my $result = <[base.s_read]>->( $file_fh, \my $buffer, 5 );

if (   not defined $result
    or $result != 5
    or not defined $buffer
    or $buffer ne '%PDF-'
    or !sysseek( $file_fh, -7, 2 ) ) {
    <[base.log]>->( 2, " <!>  header mismatch ['$buffer']" );
    $file_ok--;
}

$result = <[base.s_read]>->( $file_fh, \$buffer, 7 );

if (   not defined $result
    or $result < 6
    or not defined $buffer
    or $buffer !~ /(\r?\n)?%%EOF(\r?\n)?$/ ) {
    <[base.log]>->( 2, " <!>  footer mismatch ['$buffer']" );
    $file_ok--;

}

if (    $file_ok == 1
    and -x '/usr/bin/file'
    and qx(/usr/bin/file $file_path) =~ /PDF document/ ) {
    <[base.log]>->(
        0,
        "[!] apparent error in internal validation pattern for '$file_path'"
    );
    return 1;
}

if ($file_ok) {
    <[base.log]>->( 2, ": ok, valid." );
    return 1 if $file_ok;
} else {
    <[base.log]>->( 1, " <!>  PDF format check failed : '$file_path'" );
    return 0;
}

#.............................................................................
#2RMK7SG5SIE55WDRWMAVTBYPGFMVTSEMXP7LTQIFRS5HG7L7B335ANWV2IZADUPNAEOGPUVKZH7T2
#::: JO5C4SWF5MSLFLTK5RQ5PWVBQ26UWTGP4W7MEFPUXQLRU7K23NF :::: NAILARA AMOS :::
# :: 6LNCBCV65SUEOGB3BXL73EPB3AUTTTKNXYOFSUCHPVKBIMCDMYBQ :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
