# >:]

# name  = net.out
# descr = write data to client
# args  = filehandle, data [string]

if ( fileno $ARG[0] ) {
    my $cid = $data{'handle'}{ $ARG[0] }{'cid'};

    if (    defined $data{'handle'}{ $ARG[0] }
        and defined $cid
        and defined $data{'session'}{$cid}{'output'}
        and defined $data{'session'}{$cid}{'output'}{'handler'} ) {
        if (defined &{ $code{ $data{'session'}{$cid}{'output'}{'handler'} } }
        ) {
            <[base.s_write]>->(
                $ARG[0],
                $code{ $data{'session'}{$cid}{'output'}{'handler'} }
                    ->( $ARG[1] )
            );
        } else {
            <[base.log]>->(
                0, "[$ARG[0]] output chain handler is not valid. [ deleted ]"
            );
            $data{'session'}{$cid}{'output'}{'handler'} = undef;

            ## <[base.session.shutdown]>->( $id, 'filter chain error' );

            return 1;
        }
    } else {
        <[base.s_write]>->( $ARG[0], $ARG[1] );
    }

    if ( defined $cid ) {
        $data{'session'}{$cid}{'bytes'}{'in'} += length( $ARG[1] );
    } else {
        $data{'handle'}{ $ARG[0] }{'bytes'}{'in'} += length( $ARG[1] );
    }
    return 0;
} else {
    <[base.log]>->( 0, "[$ARG[0]] cannot send to socket" );
    return 1;
}

#.............................................................................
#CK3I3LRH2VRORL5JBG3EF5Z6MFPLS24VVYDRVTH3B2662Q6UOKMJDQPWXJPRFR6PB4DN22SF3NKDA
#::: 3YNQI3JC2Y6XOVQKTLEVCOMPIW6Z4IK5RUKO4KIYVMPWRYCXOSE :::: NAILARA AMOS :::
# :: BWSBJFVBCXUDVHI34J4ZXVNP2BBTIZ2DA5FQ255KMU5LTAJAE2BQ :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
