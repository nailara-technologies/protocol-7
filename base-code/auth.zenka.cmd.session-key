# >:]

# name  = auth.zenka.cmd.session-key
# param = <zenka> <key_str>
# descr = set up session key for zenka auth.
# todo  = parameter validation!

my $id = $$call{'session_id'};
my ( $sn_zenka, $key ) = split( / +/, $$call{'args'}, 2 );
my $zenka = $sn_zenka;  # <- $sn_zenka also contains subname if zenka has one.
my $subname = $zenka =~ s/\[(.+)\]$// ? $1 : '';

if ( $zenka ne '' and $key ne '' ) {
    if ( exists <auth.setup.usr>->{$zenka}
        and <auth.setup.usr>->{$zenka} eq ':zenka:' ) {
        $KEYS{'auth'}{'zenka'}{$sn_zenka} = blake2b_384_b64($key);
        $reply = { 'mode' => 'ack', 'data' => 'key added' };
        <[base.log]>->( 1, "[$id] received session key for '$zenka'" );
    } else {
        $reply = {
            'mode' => 'nak',
            'data' => "user '$zenka' not accepted for :zenka: auth."
        };
        <[base.log]>->(
            0,
            "[$id] add_session_key: user '$zenka'"
                . " not accepted for :zenka: auth."
        );
    }
} else {
    $reply = { 'mode' => 'nak', 'data' => 'not enough arguments' };
    &{ $code{'base.log'} }
        ( 0, "[$id] add_session_key: not enough arguments" );
}

#.............................................................................
#EALUID2L3F3V2FOUTDTMJVS7Y76TZMCMWMPEJR5F5IRCM6UOAJ7FVL66XH3JOAOVXDNNLQPV3EVRY
#::: EOSIXRFNBCJABFRAGAMJZ4OLGAWZCJFI3VB6WRDVNVIZ35LOJ4D :::: NAILARA AMOS :::
# :: ASYGV4QL3SCUGZZPYUUC6OIC5H7EVXOF7RP3IM3IKQNZZEXAGWAQ :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
