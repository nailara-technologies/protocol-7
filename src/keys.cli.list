# >:]

# name  = keys.cli.list
# descr = list exsisting nailara C25519 keys for current user

my $key_dir = <keys.default_path> // '';
my $key_usr = <crypt.C25519.key_uid_user>;

opendir( my $dir_fh, $key_dir ) or die "$key_dir: $!";
my @key_files = grep {/[^\.].*\.C25519_b64u(\.pub)?$/} sort readdir($dir_fh)
    or <[base.log]>->( 0, "no C25519 keys found for user '$key_usr'!" );
closedir($dir_fh);

return if !@key_files;    # <- no keys, skipping further output!

my %key_names;
my $max_nlen = 0;

map {
    $key_names{$_} = "'$1'" if $_ =~ /^(.+)\.C25519_b64u(\.pub)?$/;
    my $l = length( $key_names{$_} );
    $key_names{$_} =~ s|.| |g if defined $2;
    $max_nlen = $l if $l > $max_nlen
} @key_files;

<[base.log]>->( 1, "listing key files ['$key_dir']" );

print "\n :: keys for user $key_usr :.\n :\n",
    ( map { sprintf( " : %${max_nlen}s : %s\n", $key_names{$_}, $_ ) }
        @key_files ),
    "::\n\n";
