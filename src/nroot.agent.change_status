# >:]

# name  = nroot.agent.change_status
# descr = wrapper function for agent status change handler

my ( $instance_id, $new_status ) = @_;
die "no instance id specified"       if not defined $instance_id;
die "no new status string submitted" if not defined $new_status;

my $instance = <nroot.agent.instance>->{$instance_id};
if ( defined $instance->{'status'} ) {
    $instance->{'prev-status'} = $instance->{'status'};
    if ( defined $instance->{'status-since'} ) {
        my $unix = <[base.n2u_time]>->( $instance->{'status-since'} );
        $instance->{'prev-status-duration'} = <[base.parser.duration]>->($unix);
    }
}

<[nroot.handler.agent_status]>->( $instance_id, $new_status );

# ______________________________________________________________________________
#\\4FJBIT4FO4ZSBEINSQ7Q56SVQV5HNLYTCFSNNQDLDFXJZCJVNW7M6ZIHFGPZLLXLPLQDOPJ7WZVF4
# \\ SVRTHVDF5CW3LW55US7TZEM5EHFUSYL2ZN2ENQWRCQLU6FICYVON \\// C25519-BASE-32 //
#  \\// 7GOKNA2VEFYJEAI5A3P66ZUMY6ZV45GRQ7TRR3W2JOICMIYEYBI \\ CODE SIGNATURE \\
#   ````````````````````````````````````````````````````````````````````````````
