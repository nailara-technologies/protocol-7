# >:]

# name  = net.out
# descr = write data to client
# args  = filehandle, data [string]

if ( fileno $_[0] ) {
    if (    defined $data{'handle'}{ $_[0] }
        and defined $data{'handle'}{ $_[0] }{'cid'}
        and defined $data{'session'}{ $data{'handle'}{ $_[0] }{'cid'} }
        {'output'}{'handler'} ) {
        if (defined &{
                $code{
                    $data{'session'}{ $data{'handle'}{ $_[0] }{'cid'} }
                        {'output'}{'handler'}
                }
            }
        ) {
            <[base.s_write]>->(
                $_[0],
                &{  $code{
                        $data{'session'}{ $data{'handle'}{ $_[0] }{'cid'} }
                            {'output'}{'handler'}
                    }
                }( $_[1] )
            );
        } else {
            <[base.log]>->(
                0, "[$_[0]] output chain handler is not valid. [ deleted ]"
            );
            $data{'session'}{ $data{'handle'}{ $_[0] }{'cid'} }
                {'output'}{'handler'} = undef;

          #            <[base.session.shutdown]>->( $id, 'filter chain error' );
            return 1;
        }
    } else {
        <[base.s_write]>->( $_[0], $_[1] );
    }

    if ( $data{'handle'}{ $_[0] }{'cid'} ) {
        $data{'session'}{ $data{'handle'}{ $_[0] }{'cid'} }{'bytes'}{'in'}
            += length( $_[1] );
    } else {
        $data{'handle'}{ $_[0] }{'bytes'}{'in'} += length( $_[1] );
    }
    return 0;
} else {
    <[base.log]>->( 0, "[$_[0]] can not send to socket" );
    return 1;
}

# ______________________________________________________________________________
#\\GXKFJV6JLBSDIHGSJPICJ5ITWESJADNRBJOEWTN2GAGGMUOMRQXUYAX6CAQ7CORLMODFQT6XM45SO
# \\ GCACLXTLDFTCMIXEFM5BPLMRROTUYU3GV6LKMWTAF6I6CEQOASKF \\// C25519-BASE-32 //
#  \\// SEWEQ2WHGLRMGJYJU463L52QRAHSVIJPAX5FD4LRJKANV6VIWCA \\ CODE SIGNATURE \\
#   ````````````````````````````````````````````````````````````````````````````
