# >:]

# name  = root.agent.cmd.gone_child
# param = <child_pid>
# descr = notify about gone instance child subprocess

my $instance_id;
my $child_pid = $$call{'args'};

my $parent_pid = <[root.process.get_ppid]>->($child_pid);
return { 'mode' => 'nack', 'data' => 'child still here' }
    if defined $parent_pid and $parent_pid > 0;

foreach my $iid ( keys( %{<root.agent.instance>} ) ) {
    my $children
        = defined <root.agent.instance>->{$iid}->{'process'}{'child'}
        ? <root.agent.instance>->{$iid}->{'process'}{'child'}
        : {};
    next
        if not delete <root.child>->{$child_pid}
        and not delete $children->{$child_pid};

    <[base.log]>->( 1, "[instance:$iid] child pid $child_pid unlinked!" );
    return { 'mode' => 'ack', 'data' => 'unregistered' };
}

return { 'mode' => 'nack', 'data' => 'was not registered' }
