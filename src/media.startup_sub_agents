# >:]

# name = media.startup_sub_agents

return if <media.agents_started>;

<[base.log]>->( 1, "starting display [sub]agents..." );

my %display_agents;
map { $display_agents{$_} = 1 } values %{<media.content.agent_map>};
foreach my $agent_name ( keys(%display_agents) ) {
    <auth.pwd>->{$agent_name} //= ':unix:' . <system.privs.user>;
    <media.child>->{$agent_name}->{'status'} = 'starting';
    if ( !<[media.start_agent]>->($agent_name) ) {
        <[base.log]>->(
            0, "<!> failed to start '$agent_name', shutting down.."
        );
        exit(2);
    }
    <media.agents_started>++;
}

if ( !<media.declared_online> ) {
    <media.declared_online>++;
    <[base.async.get_session_id]>;    # 'media' agent status -> 'online'
}
