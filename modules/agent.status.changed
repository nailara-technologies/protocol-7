# >:]

# name = agent.status.changed

my $agent_id = $_[0]->w->data;

my $agent = $data{'agent'}{'id'}{$agent_id};

if ( $$agent{'status'} eq 'spawn' ) {
    print "RUNNING AGENT: " . $$agent{'name'} . "\n";

    $$agent{'pid'} = &{ $code{'agent.run'} }($agent_id);
}
elsif ( $$agent{'status'} eq 'shutdown' ) {
    &{ $code{'base.log'} }( 1,
        'sending kill signal to agent \'' . $$agent{'name'} .'\' (pid:'.$$agent{'pid'}. ')' );
    
    if(kill( 9, $$agent{'pid'} ))
    {
	print "SUCCESS\n";
    }
    else
    {
	print "FAILED\n";
    }
}
