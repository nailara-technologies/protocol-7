## >:] ##

# name  = mod-test.post_init

<mod-test.list.blacklisted_modules> //= <base.perlmod.reload_blacklist> // [];
<mod-test.list.registered_modules> = <[base.perlmod.all_registered]>;

<[base.logs]>->( 1, '.: loading all registered perl modules :' );

#my %module_blacklisted
#    = map { $ARG => 5 } <mod-test.list.blacklisted_modules>->@*;

my %module_blacklisted    ##  initializing with already blacklisted ones  ##
    = map {
    $ARG =~ s|::|/|g;
    $ARG .= qw| .pm | if rindex( $ARG, qw| .pm | ) == -1;
    $ARG => 5
    } <mod-test.list.blacklisted_modules>->@*;

my @load_failed;
my $load_success = 0;
<[base.log]>->( 2, ':' );
{
    ##  catching load errors and warnings  ##
    ##
    use warnings qw| FATAL |;
    local $SIG{__WARN__} = sub { die @ARG };

    foreach my $perl_module ( <mod-test.list.registered_modules>->@* ) {
        <[base.logs]>->( 2, ':. %s', $perl_module );

        eval { Module::Load::load($perl_module) };

        if ( not length $EVAL_ERROR ) {
            $load_success++;
        } else {
            $module_blacklisted{$perl_module} = 5;
        }
    }
}

<[base.log]>->( 2, ':' );
<[base.log]>->( 2, ':.,' );

if ( scalar @load_failed ) {
    <[base.logs]>->(
        ':: could not load %d modules, adding to blacklist.,',
        scalar @load_failed
    );
} else {
    <[base.logs]>->(
        ':. successfully loaded all %d modules ::',
        $load_success
    );
    <[base.logs]>->(
        ':  :. %d were already blacklisted .:',
        scalar keys %module_blacklisted
    );
}

<mod-test.list.blacklisted_modules> = [
    <[base.sort]>->(
        map {
            $ARG =~ s|::|/|g;
            $ARG .= qw| .pm | if rindex( $ARG, qw| .pm | ) == -1;
            $ARG
        } <[base.sort]>->( \%module_blacklisted )
    )
];

0;

#,,.,,,,,,.,,,,,,,,,.,..,,..,,.,,,.,.,.,,,,.,,..,,...,..,,.,,,.,,,.,.,,..,..,,
#LRVGZDCQMLA47QFQA7MFW76QRPVOFNA2T237PCKAGLAYBSPVRUDVQEJWESV5RGIC3RBLK3YMQRKYO
#\\\|MH2SHGC6AQ7PBSX2PR43OONUINR6DBAIEKXZDBHQVYETIQTRK5Y \ / AMOS7 \ YOURUM ::
#\[7]6GEPTLAUKFCBIAIIJCTHW5HZBQYZVJGC6BKLK74QG5LBQC63SQDI 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
