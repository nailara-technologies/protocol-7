# >:]

# name  = root.agent.cmd.instance_pids
# param = [instance]
# descr = return list of instance process IDs

my $instance_id = $$call{'args'};

if ( not defined $instance_id ) {
    my $reply_list = '';
    foreach my $i_id ( sort { $a <=> $b } keys %{<root.agent.instance>} ) {
        $reply_list .= join( ' ',
            $i_id,
            <root.agent.instance>->{$i_id}->{'process'}{'id'},
            sort { $a <=> $b }
                keys %{ <root.agent.instance>->{$i_id}->{'process'}{'child'} } )
            . "\n";
    }
    return { 'mode' => 'raw', 'data' => $reply_list };

} elsif ( $instance_id =~ /^\d+$/ ) {
    return { 'mode' => 'nack', 'data' => "instance not found!" }
        if not exists <root.agent.instance>->{$instance_id};
    return {
        'mode' => 'ack',
        'data' => join( ' ',
            <root.agent.instance>->{$instance_id}->{'process'}{'id'},
            sort { $a <=> $b }
                keys %{
                <root.agent.instance>->{$instance_id}->{'process'}{'child'}
                } )
    };
} else {
    return { 'mode' => 'nack', 'data' => 'instance id must be numeric!' };
}
