## [:< ##

# name  = base.perlmod.all_registered
# descr = return all in pm-dep directories registered perl module names

my $zenka_name = shift;

my $conf_path = <system.conf_path>;

my $zenka_cfg_path;
my $perlmods_found_aref = [];

if ( not -d $conf_path ) {
    <[base.s_warn]>->( 'configuration path not found [ %s ]', $conf_path );
    return undef;
} elsif ( defined $zenka_name and $zenka_name =~ <regex.base.usr> ) {
    $zenka_cfg_path = sprintf qw| %s/zenki/%s |, $conf_path, $zenka_name;
    if ( not -d $zenka_cfg_path ) {
        <[base.s_warn]>->( 'no such zenka [ %s ]', $zenka_name );
        return undef;
    }
    $zenka_cfg_path = sprintf qw| %s/pm-dep |, $zenka_cfg_path;
    if ( not -d $zenka_cfg_path ) {
        <[base.s_warn]>->(
            'no modules registered yet for zenka %s', $zenka_name
        );
        return undef;
    }
    ##  specified zenka only  ##
    $perlmods_found_aref = <[file.all_files]>->($zenka_cfg_path);

} elsif ( defined $zenka_name ) {
    <[base.s_warn]>->( 'not a valid zenka name [ %s ]', $zenka_name );
    return undef;
} else {
    $zenka_cfg_path = sprintf qw| %s/zenki |, $conf_path;    ##  all zenki  ##
    $perlmods_found_aref
        = <[file.match_files]>->( $zenka_cfg_path, qw|  recursive pm-dep  | );
}

foreach my $path_abs ( $perlmods_found_aref->@* ) { $path_abs =~ s|^.+/|| }

$perlmods_found_aref->@*    ##  exclude .placeholder  ##
    = uniq grep { index( $ARG, qw| . |, 0 ) != 0 } $perlmods_found_aref->@*;

if (wantarray) {    ##  perlmod list  ##
    return <[base.sort]>->($perlmods_found_aref);
} else {
    return [ <[base.sort]>->($perlmods_found_aref) ];    ##  ARRAY ref  ##
}

#,,.,,..,,.,.,.,,,,..,,,,,,..,...,.,.,,,.,,..,.,.,...,..,,..,,,.,,.,.,,,,,,,.,
#Y7QDNJN73IYJRF2TIMNEMMHHJ7AG5DCNBEEBBSDVAQTM52JAWAKXB47LE7WSTCCDDP45QNAJHCFVW
#\\\|ELF6Z3M352VJ2UBA3ZJTHLZRO3PNYOGX65LZWSYC3D6CYK7CRNQ \ / AMOS7 \ YOURUM ::
#\[7]TY5A2HU3BLWGLB52BCFBADPFSSVBL7QVZNUF25KOYF5JTHCLHEAA 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
