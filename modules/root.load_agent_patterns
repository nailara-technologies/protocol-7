# >:]

# name = root.load_agent_patterns

my $pattern_file = shift || '';
my $base_file_name = <system.agent.name> . '.patterns.agent_output';
my %pattern_handlers;
my $pattern_file_txt = $pattern_file;
<root.patterns.agent_output> //= {};
$pattern_file_txt = " '$pattern_file_txt'" if length($pattern_file_txt);
my $log_msg = ": loading agent output patterns$pattern_file_txt..";
( my $pattern_filename = join( '.', $base_file_name, $pattern_file ) )
    =~ s/\.$//;

if ( !-f <system.conf_path> . '/' . $pattern_filename ) {
    <[base.log]>->(
        1, "agent pattern file '$pattern_filename' not found, skipped loading.."
    );
    return;
} else {
    <[base.log]>->( 1, $log_msg );
}
my $agent_pattern_data
    = <[base.load_section_code]>->($pattern_filename)->[0]->{'output patterns'};
die "failed to load pattern data"
    if not defined $agent_pattern_data
    or ref($agent_pattern_data) ne 'ARRAY';

<root.pattern_config> = $agent_pattern_data;
