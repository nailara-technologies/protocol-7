## >:] ##

# name  = base.chk-sum.amos.truth_template_chksum
# descr = AMOS-checksum calculation with truth template
# param = template string, scalar reference  to input string

return
    warn 'expected template and input '
    . 'string for AMOS-checksum calculation <{C1}>'
    if not @ARG == 2
    or not defined $ARG[0];

my $template_string = shift;

my $truth_template_aref;
if ( not length ref $template_string ) {
    $truth_template_aref
        = AMOS7::CHKSUM::split_truth_templates($template_string);
} elsif ( ref $template_string eq qw| ARRAY | ) {
    $truth_template_aref = $template_string;
} else {
    <[base.s_warn]>->(
        'not supported ref type for truth template [ %s ]',
        ref $template_string
    );
    return undef;
}

foreach my $template ( $truth_template_aref->@* ) {
    ( my $template_valid, my $template_errstr )
        = AMOS7::CHKSUM::is_valid_template($template);
    if ( not $template_valid ) {
        <[base.s_warn]>->( '%s <{C1}>', $template_errstr );
        return undef;
    }
}

my $input_scalar_ref;
if ( not length ref $ARG[0] ) {

    ## CREATING REFERENCE TO DATA ##
    $input_scalar_ref = \join( ' ', @ARG );
    undef @ARG;    ##  no more arguments  ##

} elsif ( ref $ARG[0] eq qw| SCALAR | ) {

    $input_scalar_ref = shift(@ARG);    ## BY SCALAR REFERENCE ##
    warn '< chk-sum.amos > undefined input <{C1}>' and return undef
        if not defined $input_scalar_ref->$*;

} elsif ( ref $ARG[0] eq qw| HASH | ) {    ## read AMOS7::CHKSUM for params ##

    return AMOS7::CHKSUM::amos_template_chksum( $truth_template_aref,
        $ARG[0] );

} else {
    <[base.s_warn]>->(
        "< chk-sum.amos > unsupported reference type '%s' <{C1}>",
        ref( $ARG[0] )
    );
    return undef;
}

##[ CHECKSUM CALCULATION ]####################################################

## passing by reference ##
return AMOS7::CHKSUM::amos_template_chksum( $truth_template_aref,
    $input_scalar_ref, @ARG );

#,,..,,.,,...,.,.,...,.,.,...,,,.,,,,,.,,,,.,,..,,...,.,,,.,.,.,.,...,...,.,.,
#2N5WPI7KVDE46JFLRYVVU67V7XFMRG2VCBJRGI4QAAW5Q77NOKD3FZQ5QU6VT5IJ2WQBVWQYMPFUY
#\\\|W5HGZGHLU4JSVQX7H2S2OZX4XYDRB673VGXZMEVXHTOZUI55CZA \ / AMOS7 \ YOURUM ::
#\[7]EIXTCGTVGVS6FLG3C2I4FU6F3L62QWIRUURYITYSXDTG2R2Q3ADQ 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
