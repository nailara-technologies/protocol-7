## [:< ##

# name  = system.xcrash_hostreboot_trigger

my $crash_reboot = <system.X-11_crash.perform_host_reboot> //= 0;
my $admin_delay  = <system.X-11_crash.reboot_admin_delay>  //= 13;
my $reboot_delay = <system.X-11_crash.reboot_delay_secs>   //= 7;

# flush previous abort commands #
<system.X-11_crash.admin_reboot_abort> = FALSE;

##  system reboot not enabled  ##
return FALSE if not <[base.cfg_bool]>->($crash_reboot);

my $reboot_condition_error;
if ( not defined <system.X-11_crash.reboot_condition>
    or <system.X-11_crash.reboot_condition> !~ m|^hostname-pattern:(.+)$| ) {
    $reboot_condition_error
        = "requires valid reboot condition setup : '[hostname-pattern:..,]'";
    warn <system.X-11_crash.reboot_condition>;
} else {
    my $host_regex_str = $LAST_PAREN_MATCH;
    my ( $host_regex, $re_err ) = <[base.eval.comp_regex]>->($host_regex_str);

    if ( not defined $host_regex ) {
        $reboot_condition_error = $re_err;
        $reboot_condition_error //= 'regex error in reboot condition set-up';
    } elsif ( <system.host.hostname> !~ $host_regex ) {
        $reboot_condition_error
            = 'reboot condition hostname does not match, skipped ..,';
    }
}

if ( defined $reboot_condition_error ) {    ## <-- no system reboot.., ###
    <[base.logs]>->( 0, '<<< %s >>>', $reboot_condition_error );
    return FALSE;
}
my $total_delay = <[system.admin_reboot_warning]>->($admin_delay);
<[base.log]>->( 0, '<<< HOST SYSTEM REBOOT IN %s SECONDS >>>', $total_delay );

<system.timer.host_reboot> = <[event.add_timer]>->(
    {   'after'   => $reboot_delay,
        'handler' => qw| system.callback.xcrash_reboot |
    }
);

return TRUE;    ## <-- reboot is scheduled ###

#,,,.,,,.,,,.,,..,.,,,..,,..,,.,,,,,,,,..,,,,,..,,...,...,,..,.,,,,,.,.,,,,..,
#B3DQHO53YB5IPSZKTGZ4FPUTWYDX4BRC4YIROK5XLPO53VZCGACTLJTVDEWYGBTFEMRRKEDLFF4K2
#\\\|AGHCNVQF3I6SRYJ3GJJ4QFQQF3V2UYRKWZ34HNN7OGTEBCTT2IL \ / AMOS7 \ YOURUM ::
#\[7]4CTNJ4ZTRH6N66SDQ6UCBN5B4W6MOPGEDHIQ6GYMAJ3AFI3HPOBY 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
