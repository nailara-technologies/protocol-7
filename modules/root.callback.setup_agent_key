# >:]

# name = root.callback.setup_agent_key

my ( $instance_id, $agent_name, $agent_key ) = @_;

my $instance_data = <root.agent.instance>->{$instance_id};

my $root_core_sid;
foreach my $core_instance_id (
    @{ <[agent.instance.get_ids]>->( <[agent.get_id]>->('core') ) } ) {

    # take first, for now..
    $root_core_sid = <root.agent.instance>->{$core_instance_id}->{'session_id'};
    last;
}

<[base.proto.nailara.command.send.local]>->(
    {   'command'   => "$root_core_sid.session_key",
        'call_args' => {
            'session_id' => $root_core_sid,
            'args'       => "$agent_name $agent_key"
        },
        'reply' => {
            'handler' => 'dev.null',
            'params'  => {}
        }
    }
);
