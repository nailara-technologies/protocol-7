# >:]

# name = layout.agent_required

my $agent_name = shift;
die "expected valid agent name"
    if not defined $agent_name or !length($agent_name);

my $profile_name = <layout.current_profile>;
my $profile_data = <layout.config.profiles>->{$profile_name}->{$agent_name};

my $stop_agents = $profile_data->{'stop_agents'};
$stop_agents = $agent_name if not defined $stop_agents;

my $start_agents = $profile_data->{'start_agents'};
$start_agents = $agent_name if not defined $start_agents;

<[base.log]>->( 1, "processing agent profile '$agent_name' start up.." );

<[base.proto.nailara.command.send.local]>->( # XXX: implement 'required' command
    {   'command'   => 'core.root.stop',
        'call_args' => { 'args' => $stop_agents },
        'reply'     => {
            'handler' => 'dev.null',
            'params'  => {}
        }
    }
);
foreach my $start_name ( split( / +/, $start_agents ) ) {
    <[base.proto.nailara.command.send.local]>->(
        {   'command'   => 'core.root.start',
            'call_args' => { 'args' => $start_name },
            'reply'     => {
                'handler' => 'dev.null',    # XXX: process reply!
                'params'  => {}
            }
        }
    );
}
