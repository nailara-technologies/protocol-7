my $r_line = join ( "", (@_) );
$r_line =~ s/\[([\w|\d|\#|\%]+)\]/$replace{$1}{start}/sg;
while ( $r_line =~ /\[([\w|\d|\#|\%]+)\:([^\]]+)\]/si ) {
    my $key = $1;
    @value = split ( /,/, $2 );
    $start = $replace{$key}{start}, $end = $replace{$key}{end};
    while ( $start =~ s/\$(\d)/$value[$1-1]/sg ) { $value[0] = "" }
    $r_line =~ s/\[$key\:[^\]]+\]/$start$value[0]$end/s;
}
return $r_line;
