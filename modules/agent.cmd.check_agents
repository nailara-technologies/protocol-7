# >:]

# name       = agent.cmd.check_agents

$code{'base.log'}->( 2, "check_agents called..");

# if ( not defined $data{'user'}{'core'} ) { &{ $code{'agent.check.core'} } }

foreach my $agent_id ( keys( %{ $data{'agent'} } ) ) {
    $code{'base.log'}->( 2, "check: id: $agent_id");
    my $agent_name = $data{'agent'}{$agent_id}{'name'};
    $code{'base.log'}->( 2, "checking agent id $agent_id name: $agent_name");

    print ":::CHK:::PASS::1\n";

    $code{'base.proto.nailara.command.send.local'}->(
      {
          'command' => "core.online $agent_name",
          'reply'   => {
              'handler' => 'agent.answer.agents',
              'params'  =>
              { 'agent_name' => $agent_name, 'agent_id' => $agent_id }
          }
      }
    );

    print "::CHK::PASS::2\n";

    #  $code{'net.cmd'}->(
    #    {
    #        'handle'         => $data{'core'}{'handle'},
    #        'command'        => "usr $agent_name",
    #        'answer_handler' => 'agent.answer.agents',
    #        'handler_params' => { 'agent_id' => $agent_id }
    #    }
    #  );

}

# $SIG{'ALRM'} = $code{'agent.check_agents'};
# alarm( $data{'agent'}{'check'}{'interval'} );


