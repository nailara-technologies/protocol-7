#!/usr/bin/perl
use v5.10;
use strict;
use warnings;
use English;

$ENV{'DISPLAY'} //= ':0.0';

my $check_string = @ARGV ? join( ' ', @ARGV ) : qx | xsel -o |;
$check_string =~ s'^\s+|\s+$''sg;

exit(0) if not length $check_string;

my $text_file = '/tmp/.osd_harmony.' . $PID;
my @aosd_opts
    = ( qw| -p 1 -e 1 -o 7777 -y 44 -x 0 -n WhiteRabbit -i |, $text_file );

my $msg;
my $result_code = system( qw| harmony -q |, $check_string );
$result_code = $result_code >> 8 if $result_code != -1;

if ($result_code == 0
    and ( $check_string !~ m|^\d+(\.\d+)?$|
        or system( qw| harmony -q -n |, $check_string ) == 0 )
) {
    $msg = "'$check_string'    TRUE  IS  =)\n";
    push( @aosd_opts, qw| -u 2777 -R |, '#230769' );
} elsif ( $result_code == 202 ) {    # <-- exit code for FALSE
    $msg = "'$check_string'   is  FALSE `:|\n";
    push( @aosd_opts, qw| -u 1389 -R |, '#690723' );
} else {
    $msg = "<< invocation error : check harmony executable >>\n";
    push( @aosd_opts, qw| -u 5007 -R |, '#776407' );
}

open( FILE, '>', $text_file ) or die "[ $text_file ] $!\n";
print FILE $msg;
close FILE;

system( '/usr/bin/aosd_cat', @aosd_opts );

#.............................................................................
#WBGHODUHNEVRFMYFNPFNMUOFCRCNX6ADHUN3V3GHO2XX4ZSQ3NLNMH7Q3TBEBHRYATUTN42BVTZBQ
#::: C6Q3FAF6X7NDKTUCGYBJTH7LPO6AVR4RKCTNM45NDLQD6YCODHQ :::: NAILARA AMOS :::
# :: DP426STJGAORK6ZV2APFRNWFS3TP6KVZKADU5D5NDZCTPM6WQUDQ :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
