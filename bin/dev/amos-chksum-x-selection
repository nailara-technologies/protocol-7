#!/usr/bin/perl
use v5.10;
use strict;
use English;
use warnings;
use IPC::Open2 qw| open2 |;
use IPC::System::Simple qw| capturex |;

$ENV{'DISPLAY'} //= qw| :0.0 |;

my $check_str = @ARGV ? join( ' ', @ARGV ) : capturex qw| xsel -o |;
$check_str =~ s'^\s+|\s+$''sg;

exit(0) if not length $check_str;

chomp( my $chksum_str = capturex qw| amos-chksum -q -- |, $check_str );

$chksum_str = ' < amos checksum error > ' if not length( $chksum_str // '' );

foreach my $mode (qw| selection clipboard |) {   ## selection and clipboard ##

    my @xsel_args = $mode eq qw| clipboard | ? qw| -b -i | : qw| -p -i |;
    my $pid       = open2( my $out_fh, my $xsel_in, qw| xsel |, @xsel_args );

    print {$xsel_in} $chksum_str;                # store amos checksum ##
    close($xsel_in);

    my $err_str = readline($out_fh);
    close($out_fh);
    waitpid( $pid, 0 );
    die ":\n: xsel : \l$err_str:\n" if defined $err_str;
}

exit(0000);

#,,.,,,,.,...,,,.,...,,.,,...,.,.,...,,,.,,..,..,,...,...,,.,,,.,,..,,,..,.,.,
#GDMGEDO56LCERPMC2LAY5R7KW5ZVTBN3CNA7VKOMQCTBEX6NVWRXBZURTWBXEXBR55SPSQF7UMU3M
#\\\|EO7MDPUSEI2IFEVFIKV7UAUAEMBKKKXCSVIGN5TOEE6JECKD7C4 \ / AMOS7 \ YOURUM ::
#\[7]IBOPLH3PYSMCC5STG7IPNZHONJXZHANGERPDOGOWMFUWC4AWJACY 7  DATA SIGNATURE ::
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
