#!/usr/bin/perl

BEGIN {
    use Cwd;
    use strict;
    use English;
    use warnings;
    my $local_lib_path = Cwd::abs_path($PROGRAM_NAME);
    $local_lib_path =~ s|(/[^/]+){3}$|/data/lib-path/pm|;
    unshift( @INC, $local_lib_path ) if -d $local_lib_path;
}

use v5.24;
use AMOS::CHKSUM;
use AMOS::CHKSUM::ELF;
use AMOS::CHKSUM::ELF::Inline;
use List::Util 'max';

my $old_versions = {
    qw| AMOS::CHKSUM |              => $AMOS::CHKSUM::VERSION,
    qw| AMOS::CHKSUM::ELF |         => $AMOS::CHKSUM::ELF::VERSION,
    qw| AMOS::CHKSUM::ELF::Inline | => $AMOS::CHKSUM::ELF::Inline::VERSION
};

my $new_versions = {
    qw| AMOS::CHKSUM |              => qx| amos-chksum -VA |,
    qw| AMOS::CHKSUM::ELF |         => qx| amos-chksum -VL |,
    qw| AMOS::CHKSUM::ELF::Inline | => qx| amos-chksum -VLS |,
};

my $o_mlen = max map { length $old_versions->{$ARG} } keys %{$old_versions};
my $n_mlen = max map { length $new_versions->{$ARG} } keys %{$old_versions};

my $bg  = "\e[48;2;9;5;42m";
my $fg0 = "\e[38;2;38;46;153m";
my $fg4 = "\e[38;2;68;39;172m";
my $CT  = "\e[38;2;6;71;195m";
my $rst = "\e[0m";

say "$bg$fg0:$rst";
foreach my $module ( sort keys( %{$old_versions} ) ) {
    chomp( $new_versions->{$module} );
    next if $old_versions->{$module} eq $new_versions->{$module};
    say sprintf "$rst$fg4: ${bg}::$rst$fg4 $bg$CT%${o_mlen}s $rst"
        . "$fg4 $bg : $rst$fg4 $bg$CT %-${o_mlen}s $rst$fg4 $bg.:$rst",
        $old_versions->{$module},
        $new_versions->{$module};
}
say "$bg$fg4:$rst";
foreach my $module ( sort keys( %{$old_versions} ) ) {
    chomp( $new_versions->{$module} );
    next if $old_versions->{$module} eq $new_versions->{$module};
    system(
        qw| ncode replace all |,
        $old_versions->{$module},
        $new_versions->{$module}
    );
}
say "$bg$CT:.,$rst";

#.............................................................................
#PRTZ6TIFHLVKCQUO3E6CYS3Q4RMRPSCZ56IRLKMMIFOZD72G7K5A63RFPYGL66XGKJY7IIZBQSPHI
#::: IPLDYGBUXQHFP4D3KYWUJDN5S5ON5YXDV2YIIRP4RLOUJP4OSGO :::: NAILARA AMOS :::
# :: IRJWFJ474Y5PQH2FWFYG4O6DEZ5R3OUP77WX5PJ3UEFZ63FGS4DQ :: CODE SIGNATURE ::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
