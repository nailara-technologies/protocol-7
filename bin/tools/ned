#!/usr/bin/perl -w

# ripped example to simply select code and edit it

require 5.002;
use English;
use File::Basename;
use Tk;
use strict;
sub browse;

sub invokeself
{
 my @args = ($^X,__FILE__,@_);
 system(join(' ',@args));
}

my $MW = MainWindow->new(title=>'.: select code');

my $scroll = $MW->Scrollbar();
$scroll->pack(-side => 'right', -fill => 'y');
my $list = $MW->Listbox(
    -yscrollcommand => ['set', $scroll],
    -relief => 'flat', 
    -width => 25, 
    -height => 34,
    -setgrid => 'no',
);
$list->pack(-side => 'left', -fill => 'both', -expand => 'yes');
$scroll->configure(-command => ['yview', $list]);
$MW->minsize(1, 1);

my $dir;
if (scalar @ARGV > 0) {
    $dir = $ARGV[0];
} else {
    $dir = '/usr/local/nailara/code';
}
foreach (<${dir}/*>) {
    $list->insert('end', basename($::ARG));
}

$list->bind('all', '<Control-c>' => \&exit);
$list->bind('<Double-Button-1>' => sub {
    my($listbox) = @_;
    foreach (split ' ', $listbox->get('active')) {
	browse $dir, $::ARG;
    }
});

MainLoop;


sub browse {

    my($dir, $file) = @_;

    if ($dir ne '.') {
	$file = "$dir/$file";
    }
    if (-d $file) {
	invokeself("$file &");
    } else {
	if (-f $file) {
	    system "Eterm -g 100x50 --buttonbar=false --borderless=true --scrollbar=false -tr -O --shade=50 --tint=0x0000ff -e jed $file -f perl_mode&";
	} else {
	}
    }

}
